import json
import sys
import subprocess
from termcolor import colored

# TensorFlow and tf.keras
import tensorflow as tf

# Helper libraries
import numpy as np
import matplotlib.pyplot as plt

import extract_features
#1. process the input as an .apk file
filename = sys.argv[1]
class_name = ["BENIGN","MALICIOUS"]
test_files = extract_features.extract(filename)
# print(test_files)
#2. load the saved model and predict 

new_model = tf.keras.models.load_model('../model_training/saved_model/model_android_malware_classification')

# print(new_model.summary())
probability_model = tf.keras.Sequential([new_model, 
                                         tf.keras.layers.Softmax()])
file = np.array(test_files)
# print(file.shape)
file = (np.expand_dims(file,0))
# print(file.shape)
predictions_single = probability_model.predict(file)
# print(predictions_single)
label=np.argmax(predictions_single[0])
color = "green" if label == 0 else "red"
print(colored("This file is "+class_name[label],color))
